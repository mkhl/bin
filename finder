#!/usr/bin/env python

'''Print the POSIX path of the current selection of Finder.app.

Print one item per line, without special quotation.
If there is no selection, fall back to the target of the current window.
If there is no window open, fall back to the Desktop folder.
'''

from appscript import app, k

def finder():
    return app('Finder')

def desktop(app):
    return [app.desktop.get(resulttype = k.alias)]

def folder(app):
    try:
        return [app.windows[1].target.get(resulttype = k.alias)]
    except Exception:
        return []

def selection(app):
    return app.selection.get(resulttype = k.alias)

def finder_items(app):
    items = selection(app)
    if not items:
        items = folder(app)
    if not items:
        items = desktop(app)
    return items

def main():
    return [alias.path for alias in finder_items(finder())]

if __name__ == '__main__':
    print '\n'.join(main())
