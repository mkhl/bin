#!/usr/bin/env ruby -wKU

def passes?(file, tests)
  ENV['file'] = file
  tests.any? { |test| system(amend(test)) }
end

def amend(test)
  return test  if test['$file']
  %Q[#{test} "$file"]
end

$stdin.each { |file| puts file  if passes?(file.chomp, ARGV) }
